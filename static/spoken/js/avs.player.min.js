function syncAudioVideo(e,t){e=e,t=t,videoObj="#"+e,videoWidth=$(videoObj).attr("width"),videoHeight=$(videoObj).attr("height"),videoParent="#"+e+"-avplayer-js",$(videoObj).addClass("avs-tech"),$(videoObj).wrap('<div id="'+e+'-avplayer-js" class="avplayer-js avs-default-skin avs-paused avs-controls-enabled" style="width: '+videoWidth+"px; height: "+videoHeight+'px;">'),$(videoParent).append('<div class="avs-poster avs-hidden" tabindex="-1"></div>'),posterImage=$(videoObj).attr("poster"),void 0!=posterImage&&$(".avs-poster").css("background-image",'url("'+posterImage+'");');var a='<div class="avs-text-track-display"><div class="avs-captions" style="display: block;"><div class="avs-tt-cue"><div id="'+e+'-srt" style="display: none; margin: 0px;">',n="";$(videoObj+" track").each(function(){a+='<div class="srt avs-text-track" id="'+e+"-"+$(this).attr("label").toLowerCase()+'" data-video="'+e+'" data-srt="'+$(this).attr("src")+'" style="display:none;"></div>',n+='<li id="'+$(this).attr("label")+'" class="'+e+'-menu-item avs-menu-item" role="button" aria-live="polite" tabindex="0" aria-selected="false">'+$(this).attr("label")+"</li>",$(this).remove()}),a+="</div></div></div></div>",$(videoParent).append(a),$(videoParent).append('<div id="'+e+'-loading-spinner" class="avs-loading-spinner avs-hidden"></div>'),$(videoParent).append('<button id="'+e+'-big-play-button" class="avs-big-play-button" role="button" type="button" aria-live="polite" tabindex="0" aria-label="play video"><span class="avs-control-text">Play Video</span></button>'),$(videoParent).append('<div class="avs-control-bar" id="'+e+'-control-bar"></div>'),playBar=$(videoObj+"-control-bar"),$(playBar).append('<button id="'+e+'-play-control" class="avs-play-control avs-control avs-button  avs-paused" tabindex="0" role="button" type="button" aria-live="polite"><span class="avs-control-text">Play</span></button>'),$(playBar).append('<div class="avs-mute-control avs-volume-menu-button avs-menu-button avs-menu-button-inline avs-control" id="'+e+'-mute-control" role="button" aria-live="polite" tabindex="0"><span class="avs-control-text">Mute</span><div class="avs-menu"><div class="avs-menu-content"><div role="slider" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" tabindex="0" id="'+e+'-volume-bar" class="avs-volume-bar avs-slider-bar avs-slider avs-slider-horizontal" aria-label="volume level" aria-valuetext="100%"><div class="avs-volume-level" id="'+e+'-volume-level" style="width: 100%;"><span class="avs-control-text"></span></div><div class="avs-volume-handle avs-slider-handle" id="'+e+'-volume-handle" style="left: 96%;"><span class="avs-control-text">00:00</span></div></div></div></div></div>'),$(playBar).append('<div class="avs-progress-control avs-control" id="'+e+'-progress-holder"><div role="slider" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" tabindex="0" class="avs-progress-holder avs-slider avs-slider-horizontal" aria-label="video progress bar" aria-valuetext="" style="width: 100%"><div id="'+e+'-load-progress" class="avs-load-progress" style="width: 0%;"><span class="avs-control-text">Loaded: 0%</span></div><div class="avs-play-progress avs-slider-bar" style="width: 0%;" id="'+e+'-play-progress" data-current-time="00:00"><span class="avs-control-text">Progress: 0%</span></div><div class="avs-seek-handle avs-video-slider-handle" id="'+e+'-seek-handle" style="left: 0%;"><span class="avs-control-text">00:00</span></div></div></div>'),$(playBar).append('<div class="avs-current-time avs-time-control avs-control"><div class="avs-current-time-display" id="'+e+'-current-time-display" aria-live="off">0:00</div></div>'),$(playBar).append('<div class="avs-time-divider"><span>/</span></div>'),$(playBar).append('<div class="avs-duration avs-time-control avs-control"><div class="avs-duration-display" id="'+e+'-duration-display" aria-live="off">0:00</div></div>'),$(playBar).append('<div class="avs-remaining-time avs-time-control avs-control"><div id="'+e+'-remaining-time-display" class="avs-remaining-time-display" aria-live="off"><span class="avs-control-text">Remaining Time </span>-0:00</div></div>'),subMenu='<div class="avs-captions-button avs-menu-button avs-control avs-workinghover avs-menu-button-popup" role="button" aria-live="polite" tabindex="0" aria-haspopup="true"><div class="avs-control-content"><span class="avs-control-text">Captions</span></div><div class="avs-menu"><ul class="avs-menu-content">',subMenu+='<li class="'+e+'-menu-item avs-menu-item avs-selected" id="'+e+'-srt-off" role="button" aria-live="polite" tabindex="0" aria-selected="true">Caption off</li>',subMenu+=n,subMenu+="</ul></div></div>",$(playBar).append(subMenu),$(playBar).append('<div class="avs-fullscreen-control avs-control " id="'+e+'-fullscreen-control" role="button" aria-live="polite" tabindex="0"><div class="avs-control-content"><span class="avs-control-text">Fullscreen</span></div></div>'),new bigPlayButton(videoObj,e,t)}function bigPlayButton(e,t,a){var e=e,t=t,a=a,n=0,s=document.getElementById(a),i=document.getElementById(t),l=$(e+"-avplayer-js");$(e+"-big-play-button").click(function(){function o(){n+=1,n>5&&(u(),n=0)}function r(){$(e+"-loading-spinner").removeClass("avs-hidden")}function d(){$(e+"-loading-spinner").addClass("avs-hidden")}function u(){$(e+"-avplayer-js").addClass("avs-user-inactive"),$(e+"-avplayer-js").removeClass("avs-user-active")}function c(){l.removeClass("avs-paused"),l.addClass("avs-playing"),$(e+"-play-control").removeClass("avs-paused"),$(e+"-play-control").addClass("avs-playing")}function v(){l.addClass("avs-paused"),l.removeClass("avs-playing"),$(e+"-play-control").addClass("avs-paused"),$(e+"-play-control").removeClass("avs-playing")}function p(){function o(t){var a=secondstotime(Math.floor(t.currentTime));j&&j.html(a),$(e+"-remaining-time-display").html("-"+secondstotime(Math.floor(M.duration)-Math.floor(t.currentTime))),$(e+"-play-progress").attr("data-current-time",a)}function u(e){var t=(e-m(volumeControl))/volumeControl.offsetWidth;t>1?t=1:0>t&&(t=0),s.volume=t,p()}function p(){var t=$(e+"-volume-level"),a=$(e+"-volume-handle"),n=Math.floor(s.volume/1*100);t.css("width",n+"%"),n=Math.floor(s.volume/1*96),a.css("left",n+"%")}function m(e){for(var t=e.offsetLeft;e=e.offsetParent;)t+=e.offsetLeft;return t}function f(a){F=i.duration,E=s.duration,I=document.getElementById(t+"-progress-holder"),P=$(e+"-play-progress"),T=$(e+"-seek-handle"),newPercent=Math.max(0,Math.min(1,(a-m(I))/I.offsetWidth)),videoPrgressBarWidth=100*newPercent,P.css("width",videoPrgressBarWidth+"%"),videoPrgressBarWidth>.6&&T.css("left",videoPrgressBarWidth-.6+"%"),Math.floor(i.currentTime)<.6&&T.css("left","0%");var n=newPercent*M.duration;F>=n?i.currentTime=n:i.currentTime=F,E>=n?s.currentTime=n:s.currentTime=E}function h(){window.fullScreenApi=fullScreenAPI(),window.fullScreenApi.supportsFullScreen?(document.getElementById(t+"-fullscreen-control").addEventListener("click",function(){i=document.getElementById(t),fullScreenApi.isFullScreen()?(window.fullScreenApi.cancelFullScreen(i.parentNode),b()):(window.fullScreenApi.requestFullScreen(i.parentNode),y())}),i.parentNode.addEventListener(fullScreenApi.fullScreenEventName,function(){fullScreenApi.isFullScreen()||b()},!0),document.onfullscreenchange=function(e){fullScreenApi.isFullScreen()||b()},document.onmozfullscreenchange=function(e){fullScreenApi.isFullScreen()||b()},document.onwebkitfullscreenchange=function(e){fullScreenApi.isFullScreen()||b()}):document.getElementById(t+"-fullscreen-control").addEventListener("click",function(){w?(i.parentNode.style.width=C+"px",i.parentNode.style.height=k+"px",b()):(i.parentNode.style.width="100%",i.parentNode.style.height="100%",y())})}function y(){w=!0,i.style.width="100%",i.style.height="100%",i.style.left=0,i.style.top=0,$(e+"-avplayer-js").addClass("avs-fullscreen")}function b(){w=!1,i.parentNode.style.width=C+"px",i.parentNode.style.height=k+"px",i.style.width=C+"px",i.style.height=k+"px",$(e+"-avplayer-js").removeClass("avs-fullscreen")}var g=!1,S=!1,x=!1,w=!1,C=i.width,k=i.height,F=i.duration,E=s.duration,B=t,M=i;E>F&&(M=s,B=a);var j=$(e+"-current-time-display"),P=$(e+"-play-progress"),T=$(e+"-seek-handle");$(e+"-play-control");$(e+"-duration-display").html(secondstotime(Math.floor(M.duration))),$(e+"-play-control").click(function(){i.paused?(i.play(),g=!1,c()):(i.pause(),g=!0,v())}),l.mouseleave(function(){n=4}),l.mouseover(function(){$(this).addClass("avs-user-active"),$(this).removeClass("avs-user-inactive"),n=0}),l.mousemove(function(){$(this).addClass("avs-user-active"),$(this).removeClass("avs-user-inactive"),n=0}),$(e).click(function(){g?(i.play(),g=!1,c()):(i.pause(),g=!0,v())}),i.addEventListener("play",function(){s.paused&&!x&&s.play()},!1),i.addEventListener("pause",function(){s.paused||F==i.currentTime||s.pause()},!1),i.addEventListener("seeking",function(){x=!0,r(),g||s.pause()}),i.addEventListener("seeked",function(){S=!0,x=!1,d();var t=this.buffered.end(this.buffered.length-1)/this.duration*100;$(e+"-load-progress").css("width",t+"%")}),$("."+t+"-menu-item").each(function(a){$(this).click(function(){$(this).parent().children().each(function(e){$(this).removeClass("avs-selected")}),$(this).addClass("avs-selected"),subid=$(this).html(),$("#"+t+"-srt").children().each(function(e){$(this).css("display","none")}),subid=subid.toLowerCase(),"caption off"!=subid?($(e+"-srt").css("display","block"),$(e+"-"+subid).css("display","inline-block")):($(e+"-srt").css("display","none"),$(e+"-"+subid).css("display","none"))})}),i.addEventListener("progress",function(){var t=this.buffered.end(this.buffered.length-1)/this.duration*100;$(e+"-load-progress").css("width",t+"%")}),i.addEventListener("timeupdate",function(){if(s.readyState>=4){Math.ceil(s.currentTime)>Math.ceil(i.currentTime)&&F!=i.currentTime&&(s.currentTime=i.currentTime),o(i),S&&!g&&(s.play(),S=!1);var e=i.currentTime/M.duration*100;P.css("width",e+"%"),secondstotime(Math.floor(i.currentTime))==secondstotime(Math.floor(M.duration))&&setTimeout(function(){g=!0,v()},900)}},!1),s.addEventListener("timeupdate",function(){if(s.readyState>=4&&F==i.currentTime){o(s);var e=s.currentTime/M.duration*100;P.css("width",e+"%"),secondstotime(Math.floor(s.currentTime))==secondstotime(Math.floor(M.duration))&&setTimeout(function(){g=!0,v()},900)}},!1),volumeControl=document.getElementById(t+"-volume-bar"),volumeControl.addEventListener("mousedown",function(){s.muted||(document.onmousemove=function(e){u(e.pageX)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null})},!1),volumeControl.addEventListener("mouseup",function(e){s.muted||u(e.pageX)},!1),$(e+"-volume-bar").click(function(e){return e.stopPropagation(),!1}),$(".avs-menu").click(function(e){return e.stopPropagation(),!1}),$(e+"-mute-control").click(function(){s=document.getElementById(a);var e=$("#"+t+"-volume-level"),n=$("#"+t+"-volume-handle");s.muted?(s.muted=!1,$(this).removeClass("avs-vol-0"),volNum=Math.floor(s.volume/1*100),e.css("width",volNum+"%"),volNum=Math.floor(s.volume/1*96),n.css("left",volNum+"%")):($(this).addClass("avs-vol-0"),s.muted=!0,e.css("width","1%"),n.css("left","0%"))});var I=document.getElementById(t+"-progress-holder");I.addEventListener("mousedown",function(e){f(e.pageX),document.onmousemove=function(e){f(e.pageX)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},!0),I.addEventListener("mouseup",function(e){f(e.pageX)},!0),new h}r(),s.volume=1,i.volume=0,i.preload="auto",s.preload="auto";var m=setInterval(function(){4===s.readyState&&4===i.readyState&&(clearInterval(m),new p,d(),i.play(),setTimeout(function(){u()},5e3),setInterval(o,1e3))},10);l.addClass("avs-controls-enabled avs-has-started"),c(),$(".srt").each(function(){var e=$(this),t=e.attr("data-video");if(t){var a=e.attr("data-srt");a?$(this).load(a,function(t,a,n){playSubtitles(e)}):playSubtitles(e)}})})}function fullScreenAPI(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},t="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)e.supportsFullScreen=!0;else for(var a=0,n=t.length;n>a;a++)if(e.prefix=t[a],"undefined"!=typeof document[e.prefix+"CancelFullScreen"]){e.supportsFullScreen=!0;break}return e.supportsFullScreen&&(e.fullScreenEventName=e.prefix+"fullscreenchange",e.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},e.requestFullScreen=function(e){return""===this.prefix?e.requestFullScreen():e[this.prefix+"RequestFullScreen"]()},e.cancelFullScreen=function(e){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var t=jQuery(this);e.supportsFullScreen&&e.requestFullScreen(t)})}),e}function secondstotime(e){var t=Math.floor(e/3600);e-=3600*t;var a=Math.floor(e/60),n=e-60*a;return 10>n&&(n="0"+n),0==t?a+":"+n:t+":"+a+":"+n}function toSeconds(e){var t=0;if(e){var a=e.split(":");for(i=0;i<a.length;i++)t=60*t+parseFloat(a[i].replace(",","."))}return t}function strip(e){return e.replace(/^\s+|\s+$/g,"")}function playSubtitles(e){var a=e.attr("data-video"),l=e.text();e.text(""),l=l.replace(/\r\n|\r|\n/g,"\n");var r={};l=strip(l);var d=l.split("\n\n");for(s in d)if(st=d[s].split("\n"),st.length>=2){if(n=st[0],i=strip(st[1].split(" --> ")[0]),o=strip(st[1].split(" --> ")[1]),t=st[2],st.length>2)for(j=3;j<st.length;j++)t+="\n"+st[j];is=toSeconds(i),os=toSeconds(o),r[is]={i:i,o:o,t:t}}var u=-1;setInterval(function(){var t=document.getElementById(a).currentTime,n=-1;for(s in r){if(s>t)break;n=s}n>=0&&(n!=u?(e.html(r[n].t),u=n):r[n].o<t&&e.html(""))},100)}
