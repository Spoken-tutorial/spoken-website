{% extends 'spoken/templates/base.html' %}
{% load widget_tweaks %}
{% load static %}
{% load creationdata %}
{% block main_meta %}
    <meta name="title" content="{{ tr_rec.tutorial_detail.tutorial }} - {{ tr_rec.language.name }}">
    <meta name="description" content="{{ tr_rec.tutorial_detail.foss.description }}">
    <meta name="keywords" content="{{ tr_rec.tutorial_detail.foss }} free training in india, {% if tr_rec.common_content.keyword %} {{ tr_rec.common_content.keyword }} {% else %} {{ tr_rec.tutorial_detail.tutorial }} {% endif %}">
{% endblock %}
{% block meta %}
    <meta property="og:site_name" content="Spoken-Tutorial">
    <meta property="og:url" content="{{ request.META.HTTP_HOST }}{{ request.path}}">
    <meta property="og:title" content="{{ tr_rec.tutorial_detail.tutorial }} in {{ tr_rec.language.name }}">
    <meta property="og:image" content="{{ tr_rec.tutorial_detail|get_thumb_path:'Small' }}">
    <meta property="og:description" content="{{ tr_rec.tutorial_detail.foss.description }}">

    <meta property="og:type" content="video">
    <meta property="og:video" content="{{ media_url }}videos/{{ tr_rec.tutorial_detail.foss_id }}/{{ tr_rec.tutorial_detail_id }}/{{ tr_rec.video }}">
    {% for key in tr_rec.common_content.keyword_as_list %}
        <meta property="og:video:tag" content="{{ key }}">
    {% endfor %}
{% endblock %}
{% block uncompresscssblock %}
    <link href="{% static 'spoken/css/video-js.min.css' %}" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{% static 'spoken/css/jquery.fancybox.pack.css' %}" type="text/css" media="screen" charset="utf-8" />
{% endblock %}
{% block compressinlinecssblock %}
    <style type="text/css">
        .video-js {
            padding-top: 56.25%
        }
        .vjs-fullscreen {
            padding-top: 0px;
        }
        .playlist-container{
            background: #1a1a1a;
            margin-bottom: 20px;
        }
        .description, .order {
            font-size: 13px;
        }
        .forward {
            float: right;
        }
        .playlist ul {
             height: 330px;
             overflow-y: scroll;
             margin-bottom: 0px;
        }
        .playlist, .playlist-container, .video-container{
            padding-left: 0px;
            padding-right: 0px;
        }
        .playlist ul{
            list-style:none;
            padding-left: 0px;
        }
        .playlist ul .playlist-item{
            clear: both;
            overflow: hidden;
        }
        .playlist ul .playlist-item.active{
            background: #3a3a3a;
        }
        .playlist ul .playlist-item a{
            color: white;
            display: block;
            overflow: hidden;
            padding: 15px 10px;
        }
        .playlist ul .playlist-item.active a{
            color: orange;
        }
        .playlist ul .playlist-item:hover{
            background: gray;
        }
        .playlist ul .playlist-item .thumb, .playlist ul .playlist-item .thumb .order{
            padding-right: 10px;
        }
        .playlist-info{
            color: white;
            padding: 10px;
            background: black;
        }
        .playlist-controls{
            background: black;
            border-top: 1px solid #3a3a3a;
            padding: 10px 0;
        }
        .playlist-controls a{
            color: white;
        }
        .playlist-controls span{
            margin: 0 10px;
        }
        #content-wrapper #content-inner div.container{
            padding-left: 0px;
        }
        p.list-group-item-text {
            margin-top: 7px;
        }
        .list-zipfiles {
            overflow-x: hidden;
            max-height: 150px;
        }
        .review-data pre {
            margin-bottom: 0px;
        }
        .video-js .vjs-tech{
            position:absolute;
            top:0;
            left:0;
            width:100%;
            height:100%;
        }
        .vjs-tt-cue {
            font-size: 16px;
        }
        .video-js .vjs-text-track {
            background-color: rgba(0, 0, 0, 0.7);
        }
        .custom-jumbotron {
            background-color: white !important;
            border: none;
            padding: 0px !important;
        }
        .custom-jumbotron p {
            padding-left: 20px;
        }
        .custom-jumbotron h3 {
            margin-top: 10px;
        }
        .video-visits {
            text-align: right;
            font-weight: bold;
            font-size: 16px;
        }
        .container.playlist-container.col-lg-12.col-md-12.col-sm-12 {
            margin-bottom: 10px;
        }
        .col-lg-5.col-md-5.col-sm-5.no-padding-right.right-bar {
            margin-top: 5px;
        }
        .video-info{
            display: none;
        }
        .breadcrumb {
            background: white;
            margin: 0px;
        }
        .list-group-item{
            border-top: none;
            padding-top: 0px;
        }
        .list-group-item:first-child {
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        .hline {
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .video-share {
            margin-bottom: 10px;
        }
        .inner-shadow {
            padding: 15px;
            /*-webkit-box-shadow: 0px 0px 10px 0px rgba(84, 70, 70, 0.87);
            -moz-box-shadow: 0px 0px 10px 0px rgba(84, 70, 70, 0.87);
            box-shadow: 0px 0px 10px 0px rgba(84, 70, 70, 0.87);*/
            border: 1px solid #ddd;
        }
        .inner-sidebar {
            padding-left: 15px;
            padding-top: 5px;
        }
        .inner-content-body {
            margin-top: 5px;
        }
        .video-info-show-more, .list-group-item-container, .panel {
            margin-bottom: 14px;
        }
        a.list-group-item .list-group-item-heading {
            color: #337AB7;
        }
        .panel-body-heading {
            font-size: 16px;
            margin-bottom: 0px;
            color: #337AB7;
        }
        .panel-body .hline {
            margin-bottom: 8px;
        }
        .forum-questions h4 {
            font-family: Menlo,Monaco,Consolas,"Courier New",monospace;
            font-size: 18px;
            font-weight: bold;
        }
        .forum-questions .question {
            padding: 5px;
            clear: both;
        }
        .forum-questions .question a {
            font-weight: bold;
        }
        .forum-questions .question p {
            font-weight: normal;
            padding: 5px;
            font-size: 13px !important;
            font-family: Verdana, Arial, Helvetica, sans-serif !important;
            color: rgb(85, 85, 85) !important;
            line-height: 18px !important;
        }
        .forum-questions .question p span, .forum-questions .question p div {
            font-size: 13px !important;
            font-family: Verdana, Arial, Helvetica, sans-serif !important;
            color: rgb(85, 85, 85) !important;
            line-height: 18px !important;
        }
        .hline-inner {
            clear: both;
        }
        small {
            padding: 3px 5px;
            margin: 0 5px 0 0;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            -o-border-radius: 3px;
            border-radius: 3px;
            background: #424242;
            color: #ffffff;
            width: 100px;
            overflow: hidden;
        }
        small.timing {
            background: #a26dc8;
        }
        .forum-post {
            color: #4F8811;
        }
    </style>
{% endblock %}
{% load creationdata %}
{% block title %}{{ tr_rec.tutorial_detail.tutorial }} - {{ tr_rec.language.name }}{% endblock %}
{% block search %}{% endblock %}
{% block heading %}{{ tr_rec.tutorial_detail.tutorial }} - {{ tr_rec.language.name }}{% endblock %}
{% block content %}
    {% if tr_rec.video_status %}
    <row>
        <div class='container playlist-container col-lg-12 col-md-12 col-sm-12'>
            <div class="video-container col-lg-8 col-md-8 col-sm-8">
                    {% if tr_rec.video_id and tr_rec.video_id != None and tr_rec.video_id != '0' %}
                        <iframe width="100%" height="420px" src="//www.youtube.com/embed/{{ tr_rec.video_id }}?rel=0&modestbranding=1&iv_load_policy=1" frameborder="0" allowfullscreen></iframe>
                    {% else %}
                        <video id="st_video" class="video-js vjs-default-skin" controls preload="none" poster="{{ tr_rec.tutorial_detail|get_thumb_path:'Big' }}" width="auto" height="auto" data-setup="{}">
                            <source src="{{ media_url }}videos/{{ tr_rec.tutorial_detail.foss_id }}/{{ tr_rec.tutorial_detail_id }}/{{ tr_rec.video }}" type="video/ogg" />
                            {{ tr_rec|get_srt_path|safe }}
                        </video>
                    {% endif %}
            </div>
            <div class='playlist col-lg-4 col-md-4 col-sm-4'>
                <div class='playlist-info'>
                    <h5>{{tr_rec.tutorial_detail.foss}} Tutorials - {{tr_rec.language}} <span class="video-count pull-right">{{tr_recs|length}}</span></h5>
                </div>
                <div class='playlist-controls'>
                    <span class='backward'></span>
                    <span class='forward'></span>
                </div>
                <ul>
                    {% for rec in tr_recs %}
                        <li class="playlist-item{% if tr_rec.id == rec.id %} active{% endif %}"{% if tr_rec.id == rec.id %} data="{{ forloop.counter }}"{% endif %}>
                            <a href="/watch/{{ rec.tutorial_detail.foss.foss|get_url_name }}/{{ rec.tutorial_detail.tutorial|get_url_name }}/{{ rec.language.name }}/">
                                <div class='pull-left thumb'>
                                    <span class='order'>{% if tr_rec.id == rec.id %}<i class="fa fa-play"></i>{% else %}{{ forloop.counter }}{% endif %}</span>
                                    <img alt="{{ rec.tutorial_detail.tutorial }} - thumb" src="{{ rec.tutorial_detail|get_thumb_path:'Small' }}" width=70 >
                                </div>
                                <div class='description'>
                                    {{rec.tutorial_detail.tutorial}}
                                </div>
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </row>
    {% endif %}
    <row>
        <div class="inner-content-body col-lg-8 col-md-8 col-sm-8 no-padding">
            <div class="inner-shadow">
                <div class="row video-share">
                    <div class="ysubscribe pull-left col-lg-9 col-md-9 col-sm-9">
                        <div class="g-ytsubscribe" data-channel="SpokenTutorialIITB" data-layout="full" data-count="default" data-onytevent="onYtEvent"></div>
                    </div>
                    <p class="video-visits pull-right col-lg-3 col-md-3 col-sm-3">{{ tr_rec|get_video_visits }} visits</p>
                </div>
                <hr class="hline" />
                <ol class="breadcrumb">
                    {% with link=tr_rec.tutorial_detail.foss|instruction_sheet:tr_rec.language %}
                        {% if link %}
                            <li><a href="{{ link }}" target="_blank">Instruction Sheet</a></li>
                        {% endif %}
                    {% endwith %}

                    {% with link=tr_rec.tutorial_detail.foss|installation_sheet:tr_rec.language %}
                        {% if link %}
                            <li><a href="{{ link }}" target="_blank">Installation Sheet</a></li>
                        {% endif %}
                    {% endwith %}
                    <li><a href="/creation/report-missing-component/{{ tr_rec.id}}" class="fancybox fancybox.iframe"> Report Missing Component</a></li>
                    <li><a target="_blank" href="http://forums.spoken-tutorial.org/new-question/?category={{ tr_rec.tutorial_detail.foss.foss }}" class="forum-post">Post your Question on the Forum</a></li>
                </ol>
                <hr class="hline" />
                <pre class="custom-jumbotron"><h3><b>Outline:</b></h3><p>{{ tr_rec.outline }}</p></pre>
                <hr class="hline" />
                <hr class="hline" />
                {% if questions %}
                    <div class="forum-questions">
                      <h4>Questions posted on ST Forums:</h4>
                      {% for question in questions %}
                        <div class="question">
                            <a href="http://forums.spoken-tutorial.org/question/{{ question.id }}/{{ question.get_slugified_title }}" target="_blank">{{ question.title }}</a>
                            <p>{{ question.body|safe }}</p>
                            <div class="timing pull-left">
                                {% if not question.minute_range == 'None' %}<small class="timing">{{ question.minute_range }}M</small>{% endif %}
                                {% if not question.second_range == 'None' %}<small class="timing">{{ question.second_range }}S</small>{% endif %}
                            </div>
                            <div class="user pull-right">
                                <span>{{ question.date_created }}</span>
                                <small>{{ question.user }}</small>
                            </div>
                        </div>
                        <hr class="hline-inner" />
                      {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 no-padding right-bar">
            <div class="inner-sidebar">
                <div class="video-info-show-more">
                    <div class="video-info">
                        <table class="table table-bordered table-hover">
                            <tr>
                                <th>Width:</th><td>{{video_info.width}}</td>
                                <th>Height:</th><td>{{video_info.height}}</td>
                            </tr>
                            <tr>
                                <th>Duration:</th><td>{{video_info.duration}}</td>
                                <th>Size:</th><td>{{video_info.size}}</td>
                            </tr>
                        </table>
                    </div>
                    <p class="video-show-more no-record">Show video info</p>
                </div>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <p class="panel-body-heading"><i class="fa fa-youtube-play fa-1"></i> Pre-requisite</p>
                        <hr class="hline" />
                        {% if tr_rec.common_content.prerequisite %}
                            {% with prerequisite=tr_rec|get_prerequisite:tr_rec.common_content.prerequisite %}
                                {% if prerequisite %}
                                    <a href="/watch/{{ prerequisite }}/"><img src="{{ tr_rec.common_content.prerequisite|get_thumb_path:'Small' }}" width="70" style="padding-right: 10px;">
                                    {{ tr_rec.common_content.prerequisite.tutorial }}</a>
                                {% else %}
                                    No Pre-requisites for this tutorial.
                                {% endif %}
                            {% endwith %}
                        {% else %}
                            No Pre-requisites for this tutorial.
                        {% endif %}
                    </div>
                </div>
                <div class="list-group">
                    {% if tr_rec.common_content.assignment_status and tr_rec.common_content.assignment_status != 6 %}
                        <div  class="list-group-item-container">
                            <a href="{{ media_url }}videos/{{ tr_rec.tutorial_detail.foss_id }}/{{ tr_rec.tutorial_detail_id }}/resources/{{ tr_rec.common_content.assignment }}" target="_blank" class="list-group-item">
                                <h4 class="list-group-item-heading"><i class="fa fa-1 fa-file-text"></i>&nbsp; Assignment</h4>
                            </a>
                        </div>
                    {% endif %}
                    {% if tr_rec.common_content.code_status and tr_rec.common_content.code_status != 6 %}
                        <div  class="list-group-item-container">
                            <a href="{{ media_url }}videos/{{ tr_rec.tutorial_detail.foss_id }}/{{ tr_rec.tutorial_detail_id }}/resources/{{ tr_rec.common_content.code }}" target="_blank" class="list-group-item">
                                <h4 class="list-group-item-heading"><i class="fa fa-1 fa-archive"></i> Code files</h4>
                                {% with path=media_path|add:'videos/'|add:tutorial_path|add:'resources/'|add:tr_rec.common_content.code %}
                                    {% with code_files=path|get_zip_content %}
                                        {% if code_files %}
                                            <hr class="hline" />
                                            <ul class="list-zipfiles">
                                                {% for code_file in code_files %}
                                                    <li>{{ code_file }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    {% endwith %}
                                {% endwith %}
                            </a>
                        </div>
                    {% endif %}
                    {% if tr_rec.common_content.slide_status and tr_rec.common_content.slide_status != 6 %}
                        <div class="list-group-item-container">
                            <a href="{{ media_url }}videos/{{ tr_rec.tutorial_detail.foss_id }}/{{ tr_rec.tutorial_detail_id }}/resources/{{ tr_rec.common_content.slide }}" target="_blank" class="list-group-item">
                                <h4 class="list-group-item-heading"><i class="fa fa-1 fa-archive"></i> Slides</h4>
                                {% with path=media_path|add:'videos/'|add:tutorial_path|add:'resources/'|add:tr_rec.common_content.slide %}
                                    {% with slide_files=path|get_zip_content %}
                                        {% if slide_files %}
                                            <hr class="hline" />
                                            <ul class="list-zipfiles">
                                                {% for slide_file in slide_files %}
                                                    <li>{{ slide_file }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    {% endwith %}
                                {% endwith %}
                            </a>
                        </div>
                    {% endif %}
                    {% if tr_rec.script_status %}
                        <div class="list-group-item-container">
                            <a href="{{ script_base|add:tr_rec.script }}" target="_blank" class="list-group-item">
                                <h4 class="list-group-item-heading"><i class="fa fa-1 fa-link"></i> Script</h4>
                            </a>
                        </div>
                        {% if tr_rec.language.name == 'English' %}
                            {% with timed_script=tr_rec.script|get_timed_script:tr_rec.timed_script %}
                                {% if timed_script %}
                                    <div class="list-group-item-container">
                                        <a href="{{ timed_script }}" target="_blank" class="list-group-item">
                                            <h4 class="list-group-item-heading"><i class="fa fa-1 fa-link"></i> Timed Script</h4>
                                        </a>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </row>
{% endblock %}
{% block compressinlinejsblock %}
    <script type="text/javascript">
        $(document).ready(function(){
            currentVideo = $('.playlist-item.active');
            nextVideo = currentVideo.next('li');
            prevVideo = currentVideo.prev('li');
            var tmpHtml = currentVideo.attr('data') + '/' + $('.video-count').html()
            $('.video-count').html(tmpHtml)
            if(nextVideo.length){
                //console.log(nextVideo.children('a').attr('href'));
                $('.forward').html('<a href="'+nextVideo.children('a').attr('href')+'"><i class="fa fa-1 fa-fast-forward"></i></a>');
            } else {
                $('.forward').html('<i class="fa fa-1 fa-fast-forward"></i>');
            }
            if(prevVideo.length){
                //console.log(prevVideo.children('a').attr('href'));
                $('.backward').html('<a href="'+prevVideo.children('a').attr('href')+'"><i class="fa fa-1 fa-fast-backward"></i></a>');
            } else {
                $('.backward').html('<i class="fa fa-1 fa-fast-backward"></i>');
            }
            $(".fancybox").fancybox({
                maxWidth    : 500,
                maxHeight   : 485,
                fitToView   : true,
                autoSize    : false,
                closeClick  : false,
                openEffect  : "none",
                closeEffect : "none",
                modal       : true,
            });
            $(".video-show-more").click(function(e) {
                e.preventDefault();
                $(".video-info").slideToggle( "slow" );
                $(this).text( $(this).text() == 'Show video info' ? "Hide video info" : "Show video info");
            });
        });
    </script>
{% endblock %}
{% block uncompressjsblock %}
    <script src="{% static 'spoken/js/video.min.js' %}"></script>
    <script src="{% static 'spoken/js/jquery.fancybox.pack.js' %}"></script>
    <script src="{% static 'spoken/js/jquery.mousewheel-3.0.6.pack.js' %}"></script>
    <script src="https://apis.google.com/js/platform.js"></script>
{% endblock %}
