{% extends 'spoken/templates/base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block title %} Email Cron Task List {% endblock %}
{% block compresscssblock %}
    <link rel="stylesheet" type="text/css" href="{% static 'DataTables/css/jquery.dataTables.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'DataTables/css/buttons.dataTables.css' %}">
{% endblock %}
{% block heading %} <i class="fa fa-list-ul"></i> Email Cron Task List  {% endblock %}
{% block search %}{% endblock %}
{% block content %}
    <div class= 'filters row' >
        <form  method="post" class='form-horizontal' enctype="multipart/form-data">
          {% csrf_token %}
          <div class="col-lg-4 col-md-4 col-sm-4">
            <div class="form-group">
                <label for="id_from_date" class="col-sm-4 control-label">Subject</label>
                <div class="col-sm-8">
                  {{ form.subject }}
                    {{ form.subject.errors }}
                </div>
            </div>
            
            <div class="form-group">
                <label for="id_to_date" class="col-sm-4 control-label">Email List (1 column csv file)</label>
                <div class="col-sm-8">
                  {{ form.csvfile }}
                    {{ form.csvfile.errors }}
                </div>
                <div class="form-group">
                  <div class="col-sm-offset-4 col-sm-8">
                     <input class="btn btn-success form-control" type="submit" value="Create" />
                  </div>
               </div>
            </div>
            
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4">
          <div class="form-group">
            <label for="id_from_date" class="col-sm-4 control-label">Sender</label>
            <div class="col-sm-8">
              {{ form.sender }}
                {{ form.sender.errors }}
            </div>
        </div>
          <div class="form-group">
            <label for="id_to_date" class="col-sm-4 control-label">Message</label>
            <div class="col-sm-8">
              {{ form.message }}
                {{ form.message.errors }}
            </div>
          </div>
        </div>
        </form>
    </div>
    <!-- big chart -->
    <div id="inline" style="height: 100%; width: 100%;">
        <div id="big_chart_div" style="width:800px; height:500px; left:-999px; position:absolute; overflow:hidden;"></div>
    </div>
    <!-- big chart-->
  <div class="tab-content">
    <div class="tab-pane active" id="pending">
      {% if task %}
        <table id="id_cron" class="paleblue table table-striped table-hover table-bordered">
            <thead>
                <tr>
                  <th>#</th>
                  <th>Subject</th>
                  <th>Csv File</th>
                  <th>Message </th>
                  <th>Sender</th>
                  <th>Uploaded by</th>
                  <th>Started at</th>
                  <th>Completed at</th>
                  <th>Status</th>
                  <th>Report</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
          {% for t in task %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{t.subject}}</td>
              <td>{{t.csvfile}}</td>
              <td>{{t.message|safe|striptags|truncatewords:20}}</td>
              <td>{{t.sender}}</td>
              <td>{{t.uploaded_by}}</td>
              <td>{{t.started_at}}</td>
              <td>{{t.completed_at}}</td>
              <td>{%if t.status %}<p style="color:green;">Completed</p>{% elif t.started_at %}<p style="color:orangered;">Running</p>{% else %} <p style="color:blue;">New Task</p> {% endif %}</td>
              <td>{% if t.report %}{{t.report}} {% else %} None {% endif %}</td>
              <td>{% if t.status or  t.started_at %}Submitted{% else %}<form action="{% url 'cron:run_cron_mail'%}" method='post'>{% csrf_token %}<input type="hidden" name='cron_id' value={{t.id}} /><input class="btn btn-success" name="submit" type="submit" value="Run" /></form>{% endif %}</td>
            </tr>
          {% endfor %}
        </tbody>
        </table>
      {% else %}
        <p class='no-record'>No task found!</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
{% block compressjsblock %}
<script type="text/javascript" src="{% static 'DataTables/js/jquery.dataTables.js' %}"></script>
<script type="text/javascript"  src="{% static 'DataTables/js/dataTables.buttons.js' %}"></script>
<script type="text/javascript"  src="{% static 'DataTables/js/buttons.html5.js' %}"></script>
<script type="text/javascript"  src="{% static 'DataTables/js/buttons.print.js' %}"></script>
<script type="text/javascript"  src="{% static 'DataTables/js/pdfmake.js' %}"></script>
<script type="text/javascript"  src="{% static 'DataTables/js/vfs_fonts.js' %}"></script>
<script type="text/javascript" >
      $(document).ready( function () {
          $('#id_cron').DataTable( {
                    dom: 'Bfrtip',
                    buttons: [
                      'csv'
                    ]
                } );
      } );
</script>

{% endblock %}
{% block uncompressjsblock %}
<script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
{% endblock %}