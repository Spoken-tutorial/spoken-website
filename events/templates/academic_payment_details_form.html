{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block title %}Academic Payament Details Form{% endblock %}
{% block heading %}
  <i class="fa fa-list-ul"></i> Activate/Deactivate Academic Centers :
{% endblock %}
{% block search %}{% endblock %}
{% block cssblock %}
<style type="text/css">
	#id_pan_number,#id_gst_number{text-transform: uppercase;}
	#errors_msg{padding: 0 10px 0 10px;}
</style>

{% endblock %}
{% block content %}
{{message.tags}}
<div class="row " ><!--main div 1 style="background-color:#fad7a0"-->
	<div class='col-sm-12'>
		<div class="alert alert-warning alert-dismissable hidden" id="alert_message">
			The form is pre-filled with values from <b>previous payment details</b>. Please review them carefully before submitting.
		</div> 
	</div>
	<div class='col-sm-12'>
	
	<form action="" method="POST" class='form-horizontal' id="form">
		{% csrf_token %}
		<div class="col-sm-9">
			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_state">State <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.state class+="form-control state" %}
				{{ form.state.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_academic">Academic <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.academic class+="form-control academic" %}
				{{ form.academic.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_name_of_the_payer">Name <sup style="color:red";>*</sup><br> <small class="text-muted">(Payee name)</small> </label>
				<div class="col-sm-9">
				{% render_field form.name_of_the_payer class+="form-control name_of_the_payer" %}
				{{ form.name_of_the_payer.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_email">Email </label>
				<div class="col-sm-9">
				{% render_field form.email class+="form-control email" %}
				{{ form.email.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_phone">Phone </label>
				<div class="col-sm-9">
				{% render_field form.phone class+="form-control phone" %}
				{{ form.phone.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_subscription">Subscription <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.subscription class+="form-control subscription" %}
				{{ form.subscription.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_amount">Amount <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.amount class+="form-control amount" %}
				{{ form.amount.errors }}
				</div>
			</div>

			

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_transactionid">Transaction ID </label>
				<div class="col-sm-9">
				{% render_field form.transactionid class+="form-control transactionid" %}
				{{ form.transactionid.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_payment_date">Payment Date <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.payment_date class+="form-control payment_date" %}
				{{ form.payment_date.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_payment_status">Payment Status <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.payment_status class+="form-control payment_status" %}
				{{ form.payment_status.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_college_type">College Type <sup style="color:red";>*</sup></label>
				<div class="col-sm-9">
				{% render_field form.college_type class+="form-control college_type" %}
				{{ form.college_type.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_pan_number">PAN Number </label>
				<div class="col-sm-9 text-uppercase">
				{% render_field form.pan_number class+="form-control pan_number" %}
				{{ form.pan_number.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_gst_number">GST Number </label>
				<div class="col-sm-9 text-uppercase">
				{% render_field form.gst_number class+="form-control gst_number" %}
				{{ form.gst_number.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_customer_id">Customer ID </label>
				<div class="col-sm-9">
				{% render_field form.customer_id class+="form-control customer_id" %}
				{{ form.customer_id.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_invoice_no">Invoice Number </label>
				<div class="col-sm-9">
				{% render_field form.invoice_no class+="form-control invoice_no" %}
				{{ form.invoice_no.errors }}
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for= "id_remarks">Remarks </label>
				<div class="col-sm-9">
				{% render_field form.remarks class+="form-control remarks" %}
				{{ form.remarks.errors }}
				</div>
			</div>
			<div>
				<div class="col-sm-2"></div>
				<div class="col-sm-9" id="errors_msg"></div>
			</div>
			
			<div class="form-group">
            <div class="col-sm-offset-5 col-sm-9">
              <input class="btn btn-warning btn-lg" type="submit" id="submit_button" value="Submit" />
            </div>
          </div>
		</div>
	</form>

	</div>
</div>

     
{% endblock %}
{% block jsblock %}
<script type="text/javascript">

function validateForm(event) {
  var pan_number = $("#id_pan_number").val().toUpperCase();
  var gst_number = $("#id_gst_number").val().toUpperCase();
  let messages = []
  var errorElem = document.getElementById('errors_msg');

  var re_pan = new RegExp("[A-Z]{5}[0-9]{4}[A-Z]{1}$");
  var re_gst = new RegExp("^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}[Z]{1}[0-9A-Z]{1}$");

  if (re_pan.test(pan_number)){
  	document.getElementById("id_pan_number").style.border = "1px solid #ccc";
  }else{
  	messages.push('Invalid PAN Number');
  	document.getElementById("id_pan_number").style.border = "1px solid #ef5350";
  }

  if (re_gst.test(gst_number)){
  	document.getElementById("id_gst_number").style.border = "1px solid #ccc";
  }else{
  	messages.push('Invalid GST Number');
  	document.getElementById("id_gst_number").style.border = "1px solid #ef5350";
  }
  //if (messages.length > 0) {
  //	 var error_msg = messages.join(' , ');
  //	 document.getElementById("errors_msg").style.backgroundColor = "#ffebee";
  //	 $('#errors_msg').html(error_msg);
  //	 event.preventDefault();
  //}
 }


 $( document ).ready(function() {

	$('#id_academic').change(function(){
		var academic_id = $(this).val()
		if(academic_id){
			$.ajax({
				type: "GET",
				url: "/software-training/ajax-academic-details/",
				data: {
					'academic_id': academic_id
				},
				success: function(data){
					$('#id_college_type').val(data.college_type);
					$('#id_payment_status').val(data.payment_status);
					if(data.success){
						$('#id_name_of_the_payer').val(data.name_of_the_payer);
						$('#id_email').val(data.email);
						$('#id_phone').val(data.phone);
						$('#id_subscription').val(data.subscription);
						$('#id_pan_number').val(data.pan_number);
						$('#id_gst_number').val(data.gst_number);
						$('#alert_message').removeClass('hidden');
					}else{
						$('#id_name_of_the_payer').val("");
						$('#id_email').val("");
						$('#id_phone').val("");
						$('#id_subscription').val("");
						$('#id_pan_number').val("");
						$('#id_gst_number').val("");
						$('#alert_message').addClass('hidden');
					}
					
				},
				error: function(error){
					console.log(error)
					alert("some error occured")
				}
			})
		}
	})

$('#id_state').change(function () {
    var stateid = $(this).val();

    if (!stateid) {
        $('#id_academic').html('<option value="">---------</option>');
        return;
    }

    $.ajax({
        type: "POST",
        url: "/software-training/ajax-state-collage/",
        dataType: "json",
        data: {
            'state': stateid
        },
        success: function (data) {
            $('#id_academic').html(data);
        }
    });
});



	$('#id_subscription').change(function(){
		var type = $(this).val()
		if(type == 365){
			$('#id_amount').val(29500)
		}else if(type == 182){
			$('#id_amount').val(14750)		
		}else if(type == 455){
        $('#id_amount').val(29500)
    }

	})

 	const form = document.getElementById('form');
	form.addEventListener('submit', validateForm);

  });
 
</script>
{% endblock %}