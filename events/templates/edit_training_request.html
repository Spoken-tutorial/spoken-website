<!-- This page is used to edit the STP training request details -->
{% extends 'spoken/templates/base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block title %}Training Planner Edit{% endblock %}
{% block heading %}<i class="home-page-title-i">Training Planner Form</i>{% endblock %}
{% block search %}{% endblock %}
{% block content %}
        {% if form %}
          <div class="row well">
              <div class='col-sm-8'>
                  <form action="{{ action }}" method="post" class='form-horizontal' enctype="multipart/form-data">{% csrf_token %}
                      {% render_field form.training_planner type="hidden" value=training.training_planner_id class+="training-planner" %}
                      {% with WIDGET_ERROR_CLASS='field-error' WIDGET_REQUIRED_CLASS='field-required' %}
                      {% if form.non_field_errors %}
                      <ul>
                        {% for error in form.non_field_errors %}
                          <li>{{ error }}</li>
                        {% endfor %}
                      </ul>
                      {% endif %}

                      <div class='form-row'>
                        <div class='col-xs-12 form-group required'>
                          <label class='control-label'>Department</label>
                          {% render_field form.department class+="form-control department" tabindex="1" %}
                          {{ form.department.errors }}
                        </div>
                      </div>

                      <div class='form-row'>
                        <div class='col-xs-12 form-group required'>
                          <label class='control-label'>Batch</label>
                          {% render_field form.batch class+="form-control batch" tabindex="1" %}
                          {{ form.batch.errors }}
                        </div>
                      </div>

                      <div class='form-row'>
                        <div class='col-xs-12 form-group required'>
                          <label class='control-label'>Semester Start Date</label>
                          {% render_field form.sem_start_date class+="form-control sem_start_date date" tabindex="1" %}
                          {{ form.sem_start_date.errors }}
                        </div>
                      </div>

                      <div class='form-row'>
                        <div class='col-xs-12 form-group required'>
                          <label class='control-label'>Training Type</label>
                          {% render_field form.course_type class+="form-control course_type" tabindex="1" %}
                          {{ form.course_type.errors }}
                        </div>
                      </div>

                      <div class='form-row'>
                        <div class='col-xs-12 form-group required'>
                          <label class='control-label'>Software Course </label>
                          {% render_field form.course class+="form-control course" tabindex="1" %}
                          {{ form.course.errors }}
                        </div>
                      </div>

                      <div class="form-group">
                          <div class="col-xs-12 form-group">
                              <input class="btn btn-primary" type="submit" value="Submit" />
                              <a class="btn btn-default" href="{% url 'events:select_participants' %}">Cancel</a>
                          </div>
                      </div>
                      {% endwith %}
                  </form>
              </div>
          </div>
        {% endif %}
{% endblock %}
{% block compressjsblock %}
    <script src="{% static 'spoken/js/jquery.datetimepicker.js' %}"></script>
{% endblock %}
{% block jsblock %}
  <script>
    $(document).ready(function(){

      // getting available batches for selected department
      $('.department').on('change', function(){
        department = $(this).val();
        department_name = $(this).children("option").filter(":selected").text()
        $('.batch').html('<option>---------</option>');
        if(department != ''){
          $.ajax({
            url: "/software-training/get-batch-option/",
            type: "POST",
            data: {
              department: department,
            },
            success: function(data) {
              // loading bach options
              if(data && data['batch_option']) {
                  $('.batch').html(data['batch_option']);
              }
            }
          });
        }
      });

      // Check if batch is full or not
      $('.batch').on('change', function() {
        batch = $(this).val();
        department = $('.department').val();
        if(department != '' && batch != '') {
          $.ajax({
            url: "/software-training/get-batch-course-status/",
            type: "POST",
            data: {
              department: department,
              batch: batch,
              training_planner: $('.training-planner').val()
            },
            success: function(data) {
              if(!data && !data['batch_status']) {
                $('.batch').val('');
                alert('No. of training requests for selected batch exceeded.');
              }
            }
          });
        }
      });

      // checking if course is full or not
      $('.course_type').on('change', function(){
        course_type = $(this).val();
        //$('.course').html('<option>---------</option>');
        if(course_type != ''){
          $.ajax({
            url: "/software-training/get-course-option/",
            type: "POST",
            data: {
              course_type: course_type,
              department: "{{training.department_id}}",
              batch: "{{training.batch_id}}",
              training_planner: "{{training.training_planner_id}}"
            },
            success: function(data) {
              // loading languages
              if(data) {
                  if(data['is_full']){
                    $(".course_type").val('');
                    $('.course').val('');
                    alert('No. of training requests for selected course type exceeded.');
                  }
              }
            }
          });
        }
      });

        // date trigger
        // var sem_type = "{{tp}}";
        // var mind = 0 ; var maxd = 0;
        // if(sem_type == "Odd") {
        //   if(current_sem == "True") {
        //     mind = y+'/07/01';
        //     maxd = y+'/09/30';
        //   }
        //   else if(current_sem == "False") {
        //     mind = y+'/07/01';
        //     maxd = y+'/09/30';
        //   }
        // } else if(sem_type == "Even") {
        //   if(current_sem == "True") {
        //     mind = y+'/01/01';
        //     maxd = y+'/03/30';
        //   } else if(current_sem == "False") {
        //     mind = (y+1)+'/01/01';
        //     maxd = (y+1)+'/03/30';
        //   }
        // }
        //
        // $('#id_sem_start_date').datetimepicker({
        //   onGenerate:function( ct ){
        //       $(this).find('.xdsoft_day_of_week0')
        //           .addClass('xdsoft_disabled');
        //   },
        //   lang:'en',
        //   format:'Y-m-d',
        //   formatDate:'Y/m/d',
        //   minDate:mind,
        //   weekends:[],
        //   maxDate:maxd,
        //   step:5,
        //   timepicker:false,
        // });
    });

  </script>
{% endblock %}
